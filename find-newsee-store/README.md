# Newsee å®ä½“æŸ¥æ‰¾æ’ä»¶

**Author:** delldi  
**Version:** 0.2.0  
**Type:** tool  
**License:** MIT

## âœ¨ åŠŸèƒ½ç‰¹ç‚¹

- **å¤šçº§åŒ¹é…ç­–ç•¥**ï¼š
  - ç²¾ç¡®åŒ¹é…ï¼šç›´æ¥è¯†åˆ«æ–‡æœ¬ä¸­çš„å®ä½“åç§°
  - æ¨¡ç³ŠåŒ¹é…ï¼šåŸºäºç¼–è¾‘è·ç¦»çš„æ¨¡ç³ŠåŒ¹é…ï¼Œå¤„ç†æ‹¼å†™é”™è¯¯
  - å‘é‡æ£€ç´¢ï¼šä½¿ç”¨ Sentence-BERT è¿›è¡Œè¯­ä¹‰æœç´¢
- **åŠ¨æ€æ•°æ®åŠ è½½**ï¼šæ”¯æŒè¿è¡Œæ—¶æ›´æ–°å®ä½“æ•°æ®
- **å¯é…ç½®**ï¼šçµæ´»çš„é˜ˆå€¼å’Œå¼€å…³é…ç½®
- **å¤šè¯­è¨€æ”¯æŒ**ï¼šæ”¯æŒä¸­è‹±æ–‡å®ä½“è¯†åˆ«

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥æ–‡æœ¬] --> B[jieba ä¸­æ–‡åˆ†è¯]
    B --> C{ç²¾ç¡®åŒ¹é…?}
    C -->|æ˜¯| D[è¿”å›ç²¾ç¡®åŒ¹é…ç»“æœ]
    C -->|å¦| E{å¯ç”¨æ¨¡ç³ŠåŒ¹é…?}
    E -->|æ˜¯| F[åŸºäºç¼–è¾‘è·ç¦»çš„æ¨¡ç³ŠåŒ¹é…]
    F --> G[è¿‡æ»¤ä½åˆ†ç»“æœ]
    G --> H{æ‰¾åˆ°åŒ¹é…?}
    E -->|å¦| H
    H -->|æ˜¯| I[è¿”å›æ¨¡ç³ŠåŒ¹é…ç»“æœ]
    H -->|å¦| J[ChromaDB å‘é‡æ£€ç´¢]
    J --> K[è®¡ç®—è¯­ä¹‰ç›¸ä¼¼åº¦]
    K --> L[è¿‡æ»¤ä½åˆ†ç»“æœ]
    L --> M[è¿”å›å‘é‡æ£€ç´¢ç»“æœ]
```

### æ ¸å¿ƒæ¨¡å—

- **`entity_finder.py`**: å®ä½“æŸ¥æ‰¾å™¨æ ¸å¿ƒå®ç°
  - `EntityFinder` ç±»ï¼šç®¡ç†å®ä½“è¯†åˆ«å…¨æµç¨‹
  - æ”¯æŒå¤šç§åŒ¹é…ç­–ç•¥å’Œç»“æœåˆå¹¶
  - æä¾›æ•°æ®åŒæ­¥æ¥å£
- **`data/sample_data.py`**: ç¤ºä¾‹æ•°æ®å’Œé…ç½®
  - é»˜è®¤é¡¹ç›®å’Œæˆ¿äº§æ•°æ®
  - åœç”¨è¯åˆ—è¡¨
  - é»˜è®¤å‚æ•°é…ç½®
- **`main.py`**: æ’ä»¶å…¥å£ç‚¹
- **`find-newsee-store.py`**: Dify å·¥å…·å®ç°

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# å®‰è£…ä¾èµ–
uv pip install -r requirements.txt
```

### 2. è¿è¡Œç¤ºä¾‹

```python
from provider.entity_finder import EntityFinder

# åˆå§‹åŒ–æŸ¥æ‰¾å™¨
finder = EntityFinder()

# æŸ¥æ‰¾å®ä½“
results = finder.find_entities("æˆ‘æƒ³äº†è§£æ˜Ÿæ²³æ¹¾çš„æˆ¿äº§ä¿¡æ¯")
print(results)

# åŠ¨æ€æ›´æ–°æ•°æ®
new_projects = [{"id": "P100", "name": "æ–°é¡¹ç›®", "location": "åŒ—äº¬æµ·æ·€åŒº"}]
new_properties = [{"id": "R100", "name": "æ–°æ¥¼ç›˜1æ ‹", "project_id": "P100", "rooms": 3}]
finder.sync_data(projects=new_projects, properties=new_properties)
```

## âš™ï¸ é…ç½®é€‰é¡¹

å¯ä»¥åœ¨ `provider/data/sample_data.py` ä¸­ä¿®æ”¹é»˜è®¤é…ç½®ï¼š

```python
DEFAULT_CONFIG = {
    "fuzzy_match_threshold": 0.8,  # æ¨¡ç³ŠåŒ¹é…é˜ˆå€¼ (0-1)
    "vector_search_threshold": 0.6,  # å‘é‡æœç´¢é˜ˆå€¼ (0-1)
    "top_k": 3,  # é»˜è®¤è¿”å›ç»“æœæ•°é‡
    "enable_fuzzy": True,  # æ˜¯å¦å¯ç”¨æ¨¡ç³ŠåŒ¹é…
    "enable_vector_search": True,  # æ˜¯å¦å¯ç”¨å‘é‡æœç´¢
}
```

## ğŸ“Š æ•°æ®æ ¼å¼

### é¡¹ç›®æ•°æ®æ ¼å¼

```python
{
    "id": "P001",  # é¡¹ç›®ID
    "name": "æ˜Ÿæ²³æ¹¾",  # é¡¹ç›®åç§°
    "location": "åŒ—äº¬æœé˜³åŒº"  # é¡¹ç›®ä½ç½®
}
```

### æˆ¿äº§æ•°æ®æ ¼å¼

```python
{
    "id": "R001",  # æˆ¿äº§ID
    "name": "æ˜Ÿæ²³æ¹¾1å·æ¥¼",  # æˆ¿äº§åç§°
    "project_id": "P001",  # æ‰€å±é¡¹ç›®ID
    "rooms": 3  # æˆ¿é—´æ•°
}
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½

1. åœ¨ `entity_finder.py` ä¸­æ‰©å±• `EntityFinder` ç±»
2. æ›´æ–° `sample_data.py` ä¸­çš„é…ç½®æˆ–æ•°æ®
3. æ·»åŠ å•å…ƒæµ‹è¯•

### æµ‹è¯•

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
pytest tests/
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### åœ¨ Dify å¹³å°ä¸­è°ƒç”¨

```
æŸ¥è¯¢ç¤ºä¾‹: "åŒ—äº¬æ˜Ÿæ²³æ¹¾çš„æˆ¿äº§ä¿¡æ¯"

å“åº”:
{
  "success": true,
  "query": "åŒ—äº¬æ˜Ÿæ²³æ¹¾çš„æˆ¿äº§ä¿¡æ¯",
  "entities": [
    {
      "id": "P001",
      "name": "æ˜Ÿæ²³æ¹¾",
      "type": "project",
      "confidence": 0.95,
      "match_type": "vector"
    },
    {
      "id": "R001",
      "name": "æ˜Ÿæ²³æ¹¾1å·æ¥¼",
      "type": "property",
      "confidence": 0.89,
      "match_type": "vector"
    }
  ],
  "message": "æ‰¾åˆ° 2 ä¸ªåŒ¹é…å®ä½“"
}
```

### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| success | boolean | è¯·æ±‚æ˜¯å¦æˆåŠŸ |
| query | string | åŸå§‹æŸ¥è¯¢æ–‡æœ¬ |
| entities | array | åŒ¹é…åˆ°çš„å®ä½“åˆ—è¡¨ |
| - id | string | å®ä½“ID |
| - name | string | å®ä½“åç§° |
| - type | string | å®ä½“ç±»å‹ (project/property) |
| - confidence | float | ç½®ä¿¡åº¦ (0-1) |
| - match_type | string | åŒ¹é…ç±»å‹ (exact/fuzzy/vector) |
| message | string | å¤„ç†ç»“æœæ¶ˆæ¯ |
```
